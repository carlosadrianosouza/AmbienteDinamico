name: Deploy Dinâmico

on:
  push:
    branches:
      - develop
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    # Define dinamicamente o environment com base na branch
    environment: ${{ github.ref_name == 'main' && 'PRD' || 'STG' }}

    steps:
      - name: Checkout do código
        uses: actions/checkout@v3

      - name: Mostrar ambiente selecionado
        run: echo "Ambiente selecionado: ${{ github.ref_name == 'main' && 'PRD' || 'STG' }}"

      - name: Mostrar variável do ambiente
        run: echo "APP_ENV: $APP_ENV"
        env:
          APP_ENV: ${{ vars.APP_ENV }}

      - name: Usar segredo do ambiente
        run: echo "A chave da API foi lida com sucesso!"
        env:
          API_KEY: ${{ secrets.API_KEY }}
